<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶ˆê· ì¼ ë°€ë„ ë¬¼ì²´ì˜ ì§ˆëŸ‰ì¤‘ì‹¬ ê³„ì‚°ê¸°</title>
    
    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Plotly for graphs -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <style>
        :root {
            --primary-color: #3498db;
            --primary-light: rgba(52, 152, 219, 0.3);
            --secondary-color: #e74c3c;
            --secondary-light: rgba(231, 76, 60, 0.3);
            --success-color: #2ecc71;
            --success-light: rgba(46, 204, 113, 0.5);
            --gray-color: #95a5a6;
            --dark-color: #2c3e50;
            --background-color: #f8f9fa;
            --panel-color: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background-color);
            color: var(--dark-color);
            line-height: 1.6;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            gap: 2rem;
        }

        /* Panel Styles */
        .panel {
            background: var(--panel-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            transition: var(--transition);
        }

        .panel:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--background-color);
        }

        .panel-header h2 {
            font-size: 1.25rem;
            color: var(--dark-color);
        }

        .panel-icon {
            font-size: 1.5rem;
        }

        /* Top Section Layout */
        .top-section {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }

        @media (max-width: 1000px) {
            .top-section {
                grid-template-columns: 1fr;
            }
        }

        /* Control Panel Styles */
        .control-group {
            margin-bottom: 1.25rem;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .control-group select,
        .control-group input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        /* Slider Styles */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .slider-container input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider-value {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Formula Display */
        .formula-display {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin-top: 1rem;
            font-size: 1.1rem;
            text-align: center;
        }

        /* Graph Container */
        .graphs-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 800px) {
            .graphs-container {
                grid-template-columns: 1fr;
            }
        }

        .graph-wrapper {
            background: #fafafa;
            border-radius: 8px;
            padding: 0.5rem;
        }

        .graph-title {
            text-align: center;
            font-weight: 600;
            padding: 0.5rem;
            color: var(--dark-color);
        }

        /* Rod Visualization */
        .rod-visualization {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .rod-container {
            position: relative;
            height: 80px;
            margin: 1rem 0;
        }

        .rod {
            position: absolute;
            top: 30px;
            left: 50px;
            right: 50px;
            height: 30px;
            border-radius: 4px;
            background: linear-gradient(to right, var(--primary-light), var(--primary-color));
        }

        .rod-marker {
            position: absolute;
            top: 0;
            width: 3px;
            height: 70px;
            transform: translateX(-50%);
        }

        .rod-marker.center-of-mass {
            background: var(--secondary-color);
        }

        .rod-marker.geometric-center {
            background: var(--gray-color);
            border-style: dashed;
        }

        .rod-marker-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .rod-marker-triangle {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 15px solid var(--secondary-color);
        }

        /* Riemann Section */
        .riemann-section {
            margin-top: 2rem;
        }

        .riemann-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-secondary {
            background: var(--gray-color);
            color: white;
        }

        /* Results Display */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .result-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .result-card.highlight {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, #fff5f5, #ffffff);
        }

        .result-label {
            font-size: 0.85rem;
            color: var(--gray-color);
            margin-bottom: 0.25rem;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .result-value.primary {
            color: var(--primary-color);
        }

        .result-value.secondary {
            color: var(--secondary-color);
        }

        .result-subtitle {
            font-size: 0.75rem;
            color: var(--gray-color);
            margin-top: 0.25rem;
        }

        /* Calculation Steps */
        .calculation-steps {
            margin-top: 2rem;
        }

        .steps-toggle {
            width: 100%;
            text-align: left;
            background: none;
            border: 2px solid #e0e0e0;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .steps-toggle:hover {
            border-color: var(--primary-color);
        }

        .steps-content {
            display: none;
            padding: 1.5rem;
            border: 2px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            background: #fafafa;
        }

        .steps-content.active {
            display: block;
        }

        .step {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .step-formula {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            text-align: center;
            margin-top: 0.5rem;
            overflow-x: auto;
        }

        /* Comparison Section */
        .comparison-section {
            margin-top: 2rem;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .preset-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .preset-btn:hover {
            border-color: var(--primary-color);
            background: var(--primary-light);
        }

        .preset-btn.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table th {
            background: var(--dark-color);
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        /* Balance Simulation */
        .balance-section {
            margin-top: 2rem;
        }

        .balance-container {
            position: relative;
            height: 200px;
            background: linear-gradient(to bottom, #e8f4fc, #ffffff);
            border-radius: 8px;
            overflow: hidden;
        }

        .balance-rod {
            position: absolute;
            top: 80px;
            left: 50%;
            width: 300px;
            height: 20px;
            background: linear-gradient(to right, var(--primary-light), var(--primary-color));
            border-radius: 4px;
            transform-origin: center center;
            transform: translateX(-50%) rotate(0deg);
            transition: transform 0.3s ease;
        }

        .balance-pivot {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 40px solid var(--dark-color);
            cursor: ew-resize;
        }

        .balance-message {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            transition: var(--transition);
        }

        .balance-message.balanced {
            background: var(--success-color);
            color: white;
        }

        .balance-message.unbalanced {
            background: var(--secondary-color);
            color: white;
        }

        /* Error Display */
        .error-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #fff3cd;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .error-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .error-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s ease;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .main-container {
                padding: 1rem;
            }
            
            .riemann-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>ğŸ¯ ë¶ˆê· ì¼ ë°€ë„ ë¬¼ì²´ì˜ ì§ˆëŸ‰ì¤‘ì‹¬ ê³„ì‚°ê¸°</h1>
        <p>ì ë¶„ì˜ ì›ë¦¬ë¥¼ ì¸í„°ë™í‹°ë¸Œí•˜ê²Œ íƒêµ¬í•˜ê¸°</p>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Top Section: Controls + Main Graph -->
        <section class="top-section">
            <!-- Control Panel -->
            <div class="panel" id="control-panel">
                <div class="panel-header">
                    <span class="panel-icon">âš™ï¸</span>
                    <h2>ë°€ë„ í•¨ìˆ˜ ì„¤ì •</h2>
                </div>

                <div class="control-group">
                    <label for="density-type">ë°€ë„ í•¨ìˆ˜ ìœ í˜•</label>
                    <select id="density-type">
                        <option value="uniform">ê· ì¼: Ï(x) = c</option>
                        <option value="linear-increase">ì„ í˜• ì¦ê°€: Ï(x) = a + bx</option>
                        <option value="linear-decrease">ì„ í˜• ê°ì†Œ: Ï(x) = a - bx</option>
                        <option value="quadratic" selected>ì´ì°¨: Ï(x) = a + bxÂ²</option>
                        <option value="sine">ì‚¬ì¸íŒŒ: Ï(x) = a + bÂ·sin(Ï€x)</option>
                        <option value="exponential">ì§€ìˆ˜: Ï(x) = e^(ax)</option>
                    </select>
                </div>

                <div class="control-group" id="param-a-group">
                    <label>íŒŒë¼ë¯¸í„° a</label>
                    <div class="slider-container">
                        <input type="range" id="param-a" min="0" max="5" step="0.1" value="1">
                        <span class="slider-value" id="param-a-value">1.0</span>
                    </div>
                </div>

                <div class="control-group" id="param-b-group">
                    <label>íŒŒë¼ë¯¸í„° b</label>
                    <div class="slider-container">
                        <input type="range" id="param-b" min="-2" max="5" step="0.1" value="1">
                        <span class="slider-value" id="param-b-value">1.0</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>êµ¬ê°„ [a, b]</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <input type="number" id="interval-start" value="0" step="0.1" placeholder="ì‹œì‘ì ">
                        <input type="number" id="interval-end" value="1" step="0.1" placeholder="ëì ">
                    </div>
                </div>

                <div class="formula-display" id="formula-display">
                    $\rho(x) = 1 + x^2$
                </div>
                <div id="density-warning" style="display: none; color: #e74c3c; font-size: 0.85rem; margin-top: 0.5rem;">
                    âš ï¸ ì£¼ì˜: ì¼ë¶€ êµ¬ê°„ì—ì„œ ë°€ë„ê°€ ìŒìˆ˜ì…ë‹ˆë‹¤. íŒŒë¼ë¯¸í„°ë¥¼ ì¡°ì •í•´ì£¼ì„¸ìš”.
                </div>
            </div>

            <!-- Main Visualization -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-icon">ğŸ“Š</span>
                    <h2>ì‹œê°í™”</h2>
                </div>

                <div class="graphs-container">
                    <div class="graph-wrapper">
                        <div class="graph-title">ë°€ë„ í•¨ìˆ˜ Ï(x)</div>
                        <div id="density-graph"></div>
                    </div>
                    <div class="graph-wrapper">
                        <div class="graph-title">ê°€ì¤‘ í•¨ìˆ˜ xÂ·Ï(x)</div>
                        <div id="moment-graph"></div>
                    </div>
                </div>

                <!-- Rod Visualization -->
                <div class="rod-visualization">
                    <h3 style="margin-bottom: 0.5rem;">ë§‰ëŒ€ ì‹œê°í™”</h3>
                    <div class="rod-container" id="rod-container">
                        <div class="rod" id="rod"></div>
                        <div class="rod-marker geometric-center" id="geometric-marker">
                            <span class="rod-marker-label" style="color: var(--gray-color);">ê¸°í•˜ì¤‘ì‹¬</span>
                        </div>
                        <div class="rod-marker center-of-mass" id="com-marker">
                            <span class="rod-marker-label" style="color: var(--secondary-color);">ì§ˆëŸ‰ì¤‘ì‹¬</span>
                            <div class="rod-marker-triangle"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Riemann Sum Section -->
        <section class="panel riemann-section">
            <div class="panel-header">
                <span class="panel-icon">ğŸ“</span>
                <h2>ë¦¬ë§Œ í•© íƒêµ¬</h2>
            </div>

            <div class="riemann-controls">
                <div style="flex: 1; min-width: 200px;">
                    <label>ë¶„í•  ìˆ˜ n</label>
                    <div class="slider-container">
                        <input type="range" id="riemann-n" min="1" max="100" value="10">
                        <span class="slider-value" id="riemann-n-value">10</span>
                    </div>
                </div>
                <button class="btn btn-primary" id="play-btn" onclick="RiemannAnimator.toggle()">
                    <span id="play-icon">â–¶</span> ì¬ìƒ
                </button>
                <button class="btn btn-secondary" onclick="RiemannAnimator.reset()">
                    â†º ì´ˆê¸°í™”
                </button>
            </div>

            <div id="riemann-graph"></div>

            <!-- Results Grid -->
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-label">ì „ì²´ ì§ˆëŸ‰ M (ë¦¬ë§Œ í•©)</div>
                    <div class="result-value primary" id="mass-riemann">-</div>
                    <div class="result-subtitle">$\sum \rho(x_i) \Delta x$</div>
                </div>
                <div class="result-card">
                    <div class="result-label">ì „ì²´ ì§ˆëŸ‰ M (ì •ì ë¶„)</div>
                    <div class="result-value" id="mass-exact">-</div>
                    <div class="result-subtitle">$\int \rho(x) dx$</div>
                </div>
                <div class="result-card">
                    <div class="result-label">1ì°¨ ëª¨ë©˜íŠ¸ Mâ‚€ (ë¦¬ë§Œ í•©)</div>
                    <div class="result-value primary" id="moment-riemann">-</div>
                    <div class="result-subtitle">$\sum x_i \rho(x_i) \Delta x$</div>
                </div>
                <div class="result-card">
                    <div class="result-label">1ì°¨ ëª¨ë©˜íŠ¸ Mâ‚€ (ì •ì ë¶„)</div>
                    <div class="result-value" id="moment-exact">-</div>
                    <div class="result-subtitle">$\int x \rho(x) dx$</div>
                </div>
                <div class="result-card highlight">
                    <div class="result-label">ì§ˆëŸ‰ì¤‘ì‹¬ xÌ„ (ê·¼ì‚¬)</div>
                    <div class="result-value secondary" id="com-riemann">-</div>
                    <div class="result-subtitle">ë¦¬ë§Œ í•© ê¸°ë°˜</div>
                </div>
                <div class="result-card highlight">
                    <div class="result-label">ì§ˆëŸ‰ì¤‘ì‹¬ xÌ„ (ì •í™•)</div>
                    <div class="result-value secondary" id="com-exact">-</div>
                    <div class="result-subtitle">$M_0 / M$</div>
                </div>
            </div>

            <!-- Error Display -->
            <div style="margin-top: 1rem;">
                <div class="error-display">
                    <span>ì •í™•ë„:</span>
                    <div class="error-bar">
                        <div class="error-fill" id="accuracy-bar" style="width: 0%"></div>
                    </div>
                    <span id="accuracy-value">0%</span>
                </div>
            </div>
        </section>

        <!-- Calculation Steps Section -->
        <section class="panel calculation-steps">
            <button class="steps-toggle" onclick="CalculationSteps.toggle()">
                <span>ğŸ“ ê³„ì‚° ê³¼ì • ìƒì„¸ ë³´ê¸°</span>
                <span id="steps-arrow">â–¼</span>
            </button>
            <div class="steps-content" id="steps-content">
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">1</span>
                        ë¬¸ì œ ì •ì˜
                    </div>
                    <p>êµ¬ê°„ $[a, b]$ì—ì„œ ë°€ë„ í•¨ìˆ˜ $\rho(x)$ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, ì§ˆëŸ‰ì¤‘ì‹¬ $\bar{x}$ë¥¼ êµ¬í•©ë‹ˆë‹¤.</p>
                    <div class="step-formula" id="step1-formula">
                        $$\bar{x} = \frac{\int_a^b x \cdot \rho(x) \, dx}{\int_a^b \rho(x) \, dx} = \frac{M_0}{M}$$
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">
                        <span class="step-number">2</span>
                        ì „ì²´ ì§ˆëŸ‰ ê³„ì‚°
                    </div>
                    <div class="step-formula" id="step2-formula">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">
                        <span class="step-number">3</span>
                        1ì°¨ ëª¨ë©˜íŠ¸ ê³„ì‚°
                    </div>
                    <div class="step-formula" id="step3-formula">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <div class="step">
                    <div class="step-title">
                        <span class="step-number">4</span>
                        ì§ˆëŸ‰ì¤‘ì‹¬ ê³„ì‚°
                    </div>
                    <div class="step-formula" id="step4-formula">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Comparison Section -->
        <section class="panel comparison-section">
            <div class="panel-header">
                <span class="panel-icon">ğŸ“‹</span>
                <h2>ë°€ë„ í•¨ìˆ˜ ë¹„êµ</h2>
            </div>

            <div class="preset-buttons">
                <button class="preset-btn" onclick="ComparisonManager.applyPreset('uniform')">ê· ì¼ ë°€ë„</button>
                <button class="preset-btn" onclick="ComparisonManager.applyPreset('left-heavy')">ì™¼ìª½ ë¬´ê±°ì›€</button>
                <button class="preset-btn" onclick="ComparisonManager.applyPreset('right-heavy')">ì˜¤ë¥¸ìª½ ë¬´ê±°ì›€</button>
                <button class="preset-btn" onclick="ComparisonManager.applyPreset('center-heavy')">ì¤‘ì•™ ë¬´ê±°ì›€</button>
                <button class="preset-btn" onclick="ComparisonManager.applyPreset('edges-heavy')">ì–‘ë ë¬´ê±°ì›€</button>
            </div>

            <div id="comparison-graph"></div>

            <table class="comparison-table" id="comparison-table">
                <thead>
                    <tr>
                        <th>ë°€ë„ í•¨ìˆ˜</th>
                        <th>ì „ì²´ ì§ˆëŸ‰ M</th>
                        <th>1ì°¨ ëª¨ë©˜íŠ¸ Mâ‚€</th>
                        <th>ì§ˆëŸ‰ì¤‘ì‹¬ xÌ„</th>
                        <th>ê¸°í•˜ì¤‘ì‹¬ê³¼ì˜ ì°¨ì´</th>
                    </tr>
                </thead>
                <tbody id="comparison-tbody">
                    <!-- Dynamic content -->
                </tbody>
            </table>
        </section>

        <!-- Balance Simulation Section -->
        <section class="panel balance-section">
            <div class="panel-header">
                <span class="panel-icon">âš–ï¸</span>
                <h2>ê· í˜• ì‹œë®¬ë ˆì´ì…˜</h2>
            </div>
            <p style="margin-bottom: 1rem; color: var(--gray-color);">
                ì‚¼ê°í˜• ë°›ì¹¨ëŒ€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë§‰ëŒ€ì˜ ê· í˜•ì ì„ ì°¾ì•„ë³´ì„¸ìš”. ì§ˆëŸ‰ì¤‘ì‹¬ì—ì„œë§Œ ê· í˜•ì´ ì¡í™ë‹ˆë‹¤!
            </p>
            <div class="balance-container" id="balance-container">
                <div class="balance-rod" id="balance-rod"></div>
                <div class="balance-pivot" id="balance-pivot"></div>
                <div class="balance-message" id="balance-message">ë“œë˜ê·¸í•˜ì—¬ ê· í˜•ì  ì°¾ê¸°</div>
            </div>
            <div style="margin-top: 1rem; text-align: center;">
                <span>ë°›ì¹¨ì  ìœ„ì¹˜: </span>
                <strong id="pivot-position">0.500</strong>
                <span> | ì§ˆëŸ‰ì¤‘ì‹¬: </span>
                <strong id="balance-com">0.563</strong>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>ì ë¶„ì„ í™œìš©í•œ ì§ˆëŸ‰ì¤‘ì‹¬ ê³„ì‚° ì‹œë®¬ë ˆì´í„° | ìˆ˜í•™ íƒêµ¬ ë³´ê³ ì„œ</p>
    </footer>

    <script>
        // ============================================================
        // SOLID ì›ì¹™ ì ìš©: ëª¨ë“ˆí™”ëœ JavaScript êµ¬ì¡°
        // S: Single Responsibility - ê° í´ë˜ìŠ¤/ëª¨ë“ˆì€ í•˜ë‚˜ì˜ ì±…ì„ë§Œ ê°€ì§
        // O: Open/Closed - í™•ì¥ì— ì—´ë ¤ìˆê³ , ìˆ˜ì •ì— ë‹«í˜€ìˆìŒ
        // L: Liskov Substitution - ë°€ë„ í•¨ìˆ˜ë“¤ì´ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ ì¤€ìˆ˜
        // I: Interface Segregation - í•„ìš”í•œ ì¸í„°í˜ì´ìŠ¤ë§Œ ë…¸ì¶œ
        // D: Dependency Inversion - ì¶”ìƒí™”ì— ì˜ì¡´
        // ============================================================

        // ============================================================
        // 1. ë°€ë„ í•¨ìˆ˜ ëª¨ë“ˆ (Single Responsibility: ë°€ë„ í•¨ìˆ˜ ì •ì˜ë§Œ ë‹´ë‹¹)
        // ============================================================
        const DensityFunctions = {
        uniform: {
            fn: (x, { a }) => Math.max(0.01, a),
            latex: (a, b) => `\\rho(x) = ${a.toFixed(1)}`,
            name: 'ê· ì¼'
        },
        'linear-increase': {
            fn: (x, { a, b }) => Math.max(0.01, a + b * x),
            latex: (a, b) => `\\rho(x) = ${a.toFixed(1)} + ${b.toFixed(1)}x`,
            name: 'ì„ í˜• ì¦ê°€'
        },
        'linear-decrease': {
            fn: (x, { a, b, intervalEnd }) => {
                // êµ¬ê°„ ëì—ì„œë„ ì–‘ìˆ˜ê°€ ë˜ë„ë¡ ë³´ì •
                const value = a - b * x;
                return Math.max(0.01, value);
            },
            latex: (a, b) => `\\rho(x) = ${a.toFixed(1)} - ${b.toFixed(1)}x`,
            name: 'ì„ í˜• ê°ì†Œ'
        },
        quadratic: {
            fn: (x, { a, b }) => Math.max(0.01, a + b * x * x),
            latex: (a, b) => `\\rho(x) = ${a.toFixed(1)} + ${b.toFixed(1)}x^2`,
            name: 'ì´ì°¨'
        },
        sine: {
            // a > b ì¡°ê±´ìœ¼ë¡œ í•­ìƒ ì–‘ìˆ˜ ë³´ì¥
            fn: (x, { a, b }) => Math.max(0.01, a + b * Math.sin(Math.PI * x)),
            latex: (a, b) => `\\rho(x) = ${a.toFixed(1)} + ${b.toFixed(1)}\\sin(\\pi x)`,
            name: 'ì‚¬ì¸íŒŒ'
        },
        exponential: {
            // ì§€ìˆ˜í•¨ìˆ˜ëŠ” í•­ìƒ ì–‘ìˆ˜
            fn: (x, { a }) => Math.exp(a * x),
            latex: (a, b) => `\\rho(x) = e^{${a.toFixed(1)}x}`,
            name: 'ì§€ìˆ˜'
        }
    };
        // ============================================================
        // 2. ìˆ˜ì¹˜ ì ë¶„ ëª¨ë“ˆ (Single Responsibility: ìˆ˜ì¹˜ ê³„ì‚°ë§Œ ë‹´ë‹¹)
        // ============================================================
        const NumericalIntegration = {
            // ë¦¬ë§Œ í•© (ì™¼ìª½ ëì )
            riemannSum(f, a, b, n) {
                const dx = (b - a) / n;
                let sum = 0;
                for (let i = 0; i < n; i++) {
                    sum += f(a + i * dx) * dx;
                }
                return sum;
            },

            // ë¦¬ë§Œ í•© ë°ì´í„° (ì‹œê°í™”ìš©)
            riemannSumData(f, a, b, n) {
                const dx = (b - a) / n;
                const bars = [];
                for (let i = 0; i < n; i++) {
                    const x = a + i * dx;
                    bars.push({ x, width: dx, height: f(x) });
                }
                return bars;
            },

            // Simpson ë²•ì¹™ (ë” ì •í™•í•œ ìˆ˜ì¹˜ ì ë¶„)
            simpson(f, a, b, n = 1000) {
                if (n % 2 !== 0) n++;
                const h = (b - a) / n;
                let sum = f(a) + f(b);
                
                for (let i = 1; i < n; i++) {
                    const x = a + i * h;
                    sum += (i % 2 === 0 ? 2 : 4) * f(x);
                }
                
                return (h / 3) * sum;
            },

            // ì§ˆëŸ‰ì¤‘ì‹¬ ê³„ì‚°
            centerOfMass(rho, a, b, n = 1000) {
                const mass = this.simpson(rho, a, b, n);
                const moment = this.simpson(x => x * rho(x), a, b, n);
                return {
                    mass,
                    moment,
                    centerOfMass: moment / mass
                };
            },

            // ë¦¬ë§Œ í•©ìœ¼ë¡œ ì§ˆëŸ‰ì¤‘ì‹¬ ê³„ì‚°
            centerOfMassRiemann(rho, a, b, n) {
                const mass = this.riemannSum(rho, a, b, n);
                const moment = this.riemannSum(x => x * rho(x), a, b, n);
                return {
                    mass,
                    moment,
                    centerOfMass: moment / mass
                };
            }
        };

        // ============================================================
        // 3. ìƒíƒœ ê´€ë¦¬ ëª¨ë“ˆ (Single Responsibility: ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœë§Œ ê´€ë¦¬)
        // ============================================================
        const AppState = {
            densityType: 'quadratic',
            paramA: 1,
            paramB: 1,
            intervalStart: 0,
            intervalEnd: 1,
            riemannN: 10,
            
            // Observer íŒ¨í„´: ìƒíƒœ ë³€ê²½ ì‹œ ì½œë°± í˜¸ì¶œ
            listeners: [],
            
            subscribe(callback) {
                this.listeners.push(callback);
            },
            
            notify() {
                this.listeners.forEach(callback => callback(this));
            },
            
            update(newState) {
                Object.assign(this, newState);
                this.notify();
            },
            
            getDensityFunction() {
                const config = DensityFunctions[this.densityType];
                return (x) => config.fn(x, { a: this.paramA, b: this.paramB });
            },
            
            getLatex() {
                const config = DensityFunctions[this.densityType];
                return config.latex(this.paramA, this.paramB);
            }
        };

        // ============================================================
        // 4. ê·¸ë˜í”„ ë Œë”ëŸ¬ ëª¨ë“ˆ (Single Responsibility: ê·¸ë˜í”„ ë Œë”ë§ë§Œ ë‹´ë‹¹)
        // ============================================================
        const GraphRenderer = {
            config: {
                responsive: true,
                displayModeBar: false
            },
            
            layout: {
                margin: { t: 30, r: 20, b: 40, l: 50 },
                xaxis: { title: 'x' },
                yaxis: { title: '', rangemode: 'tozero' },
                showlegend: false
            },

            // ë°€ë„ í•¨ìˆ˜ ê·¸ë˜í”„
            renderDensityGraph(containerId, state) {
                const { intervalStart: a, intervalEnd: b } = state;
                const rho = state.getDensityFunction();
                
                const xVals = this.linspace(a, b, 200);
                const yVals = xVals.map(rho);

                const trace = {
                    x: xVals,
                    y: yVals,
                    type: 'scatter',
                    mode: 'lines',
                    fill: 'tozeroy',
                    fillcolor: 'rgba(52, 152, 219, 0.3)',
                    line: { color: '#3498db', width: 3 }
                };

                const layout = {
                    ...this.layout,
                    yaxis: { ...this.layout.yaxis, title: 'Ï(x)' },
                    height: 250
                };

                Plotly.react(containerId, [trace], layout, this.config);
            },

            // ëª¨ë©˜íŠ¸ í•¨ìˆ˜ ê·¸ë˜í”„
            renderMomentGraph(containerId, state) {
                const { intervalStart: a, intervalEnd: b } = state;
                const rho = state.getDensityFunction();
                
                const xVals = this.linspace(a, b, 200);
                const yVals = xVals.map(x => x * rho(x));

                const trace = {
                    x: xVals,
                    y: yVals,
                    type: 'scatter',
                    mode: 'lines',
                    fill: 'tozeroy',
                    fillcolor: 'rgba(231, 76, 60, 0.3)',
                    line: { color: '#e74c3c', width: 3 }
                };

                const layout = {
                    ...this.layout,
                    yaxis: { ...this.layout.yaxis, title: 'xÂ·Ï(x)' },
                    height: 250
                };

                Plotly.react(containerId, [trace], layout, this.config);
            },

            // ë¦¬ë§Œ í•© ê·¸ë˜í”„
            renderRiemannGraph(containerId, state) {
                const { intervalStart: a, intervalEnd: b, riemannN: n } = state;
                const rho = state.getDensityFunction();
                
                // ì—°ì† í•¨ìˆ˜
                const xVals = this.linspace(a, b, 200);
                const yVals = xVals.map(rho);

                const continuousTrace = {
                    x: xVals,
                    y: yVals,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Ï(x)',
                    line: { color: '#3498db', width: 3 }
                };

                // ë¦¬ë§Œ í•© ë§‰ëŒ€
                const bars = NumericalIntegration.riemannSumData(rho, a, b, n);
                const barTrace = {
                    x: bars.map(bar => bar.x + bar.width / 2),
                    y: bars.map(bar => bar.height),
                    type: 'bar',
                    name: 'ë¦¬ë§Œ í•©',
                    marker: { color: 'rgba(46, 204, 113, 0.5)' },
                    width: bars[0]?.width * 0.95 || 0.1
                };

                // ì§ˆëŸ‰ì¤‘ì‹¬ ìˆ˜ì§ì„ 
                const result = NumericalIntegration.centerOfMass(rho, a, b);
                const comTrace = {
                    x: [result.centerOfMass, result.centerOfMass],
                    y: [0, Math.max(...yVals) * 1.2],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'ì§ˆëŸ‰ì¤‘ì‹¬',
                    line: { color: '#e74c3c', width: 3, dash: 'dash' }
                };

                const layout = {
                    ...this.layout,
                    height: 300,
                    showlegend: true,
                    legend: { x: 0.7, y: 1 },
                    barmode: 'overlay'
                };

                Plotly.react(containerId, [barTrace, continuousTrace, comTrace], layout, this.config);
            },

            // ë¹„êµ ê·¸ë˜í”„
            renderComparisonGraph(containerId, comparisons) {
                const traces = comparisons.map((comp, idx) => {
                    const colors = ['#3498db', '#e74c3c', '#2ecc71', '#9b59b6', '#f39c12'];
                    return {
                        x: comp.xVals,
                        y: comp.yVals,
                        type: 'scatter',
                        mode: 'lines',
                        name: comp.name,
                        line: { color: colors[idx % colors.length], width: 2 }
                    };
                });

                // ì§ˆëŸ‰ì¤‘ì‹¬ ë§ˆì»¤
                comparisons.forEach((comp, idx) => {
                    const colors = ['#3498db', '#e74c3c', '#2ecc71', '#9b59b6', '#f39c12'];
                    traces.push({
                        x: [comp.centerOfMass],
                        y: [0],
                        type: 'scatter',
                        mode: 'markers',
                        name: `${comp.name} ì§ˆëŸ‰ì¤‘ì‹¬`,
                        marker: { 
                            color: colors[idx % colors.length], 
                            size: 15, 
                            symbol: 'triangle-up'
                        },
                        showlegend: false
                    });
                });

                const layout = {
                    ...this.layout,
                    height: 300,
                    showlegend: true,
                    legend: { orientation: 'h', y: -0.2 }
                };

                Plotly.react(containerId, traces, layout, this.config);
            },

            // ìœ í‹¸ë¦¬í‹°: ë“±ê°„ê²© ë°°ì—´ ìƒì„±
            linspace(start, end, num) {
                const arr = [];
                const step = (end - start) / (num - 1);
                for (let i = 0; i < num; i++) {
                    arr.push(start + step * i);
                }
                return arr;
            }
        };

        // ============================================================
        // 5. UI ì—…ë°ì´í„° ëª¨ë“ˆ (Single Responsibility: DOM ì—…ë°ì´íŠ¸ë§Œ ë‹´ë‹¹)
        // ============================================================
        const UIUpdater = {
            updateFormulaDisplay(state) {
                const latex = state.getLatex();
                const container = document.getElementById('formula-display');
                container.innerHTML = `$${latex}$`;
                this.renderMath(container);
            },
            checkDensityValidity(state) {
                const rho = state.getDensityFunction();
                const { intervalStart: a, intervalEnd: b } = state;
                const testPoints = GraphRenderer.linspace(a, b, 50);
                
                const hasNegative = testPoints.some(x => rho(x) <= 0);
                
                const warningEl = document.getElementById('density-warning');
                if (warningEl) {
                    warningEl.style.display = hasNegative ? 'block' : 'none';
                }
            },


            updateResults(state) {
                const rho = state.getDensityFunction();
                const { intervalStart: a, intervalEnd: b, riemannN: n } = state;

                // ì •í™•í•œ ê°’
                const exact = NumericalIntegration.centerOfMass(rho, a, b);
                
                // ë¦¬ë§Œ í•©
                const riemann = NumericalIntegration.centerOfMassRiemann(rho, a, b, n);

                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('mass-exact').textContent = exact.mass.toFixed(6);
                document.getElementById('mass-riemann').textContent = riemann.mass.toFixed(6);
                document.getElementById('moment-exact').textContent = exact.moment.toFixed(6);
                document.getElementById('moment-riemann').textContent = riemann.moment.toFixed(6);
                document.getElementById('com-exact').textContent = exact.centerOfMass.toFixed(6);
                document.getElementById('com-riemann').textContent = riemann.centerOfMass.toFixed(6);

                // ì •í™•ë„ ë°”
                const error = Math.abs(riemann.centerOfMass - exact.centerOfMass) / exact.centerOfMass;
                const accuracy = Math.max(0, (1 - error) * 100);
                document.getElementById('accuracy-bar').style.width = `${accuracy}%`;
                document.getElementById('accuracy-value').textContent = `${accuracy.toFixed(1)}%`;

                return exact;
            },

            updateRodVisualization(state, exact) {
                const { intervalStart: a, intervalEnd: b } = state;
                const range = b - a;
                const geometricCenter = (a + b) / 2;
                
                // ë§‰ëŒ€ ê·¸ë¼ë°ì´ì…˜ ì—…ë°ì´íŠ¸
                const rod = document.getElementById('rod');
                const rho = state.getDensityFunction();
                const gradient = this.createDensityGradient(rho, a, b);
                rod.style.background = gradient;

                // ë§ˆì»¤ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
                const rodContainer = document.getElementById('rod-container');
                const containerWidth = rodContainer.offsetWidth - 100; // padding ì œì™¸
                
                const geoPos = ((geometricCenter - a) / range) * containerWidth + 50;
                const comPos = ((exact.centerOfMass - a) / range) * containerWidth + 50;

                document.getElementById('geometric-marker').style.left = `${geoPos}px`;
                document.getElementById('com-marker').style.left = `${comPos}px`;
            },

            createDensityGradient(rho, a, b) {
                const steps = 20;
                const colors = [];
                let maxRho = 0;
                
                for (let i = 0; i <= steps; i++) {
                    const x = a + (i / steps) * (b - a);
                    maxRho = Math.max(maxRho, rho(x));
                }

                for (let i = 0; i <= steps; i++) {
                    const x = a + (i / steps) * (b - a);
                    const intensity = rho(x) / maxRho;
                    const alpha = 0.3 + intensity * 0.7;
                    colors.push(`rgba(52, 152, 219, ${alpha}) ${(i / steps) * 100}%`);
                }

                return `linear-gradient(to right, ${colors.join(', ')})`;
            },

            updateCalculationSteps(state, exact) {
                const { intervalStart: a, intervalEnd: b } = state;
                const latex = state.getLatex();
                
                // Step 2: ì§ˆëŸ‰ ê³„ì‚°
                document.getElementById('step2-formula').innerHTML = `
                    $$M = \\int_{${a}}^{${b}} ${latex.replace('\\rho(x) = ', '')} \\, dx = ${exact.mass.toFixed(4)}$$
                `;

                // Step 3: ëª¨ë©˜íŠ¸ ê³„ì‚°
                document.getElementById('step3-formula').innerHTML = `
                    $$M_0 = \\int_{${a}}^{${b}} x \\cdot (${latex.replace('\\rho(x) = ', '')}) \\, dx = ${exact.moment.toFixed(4)}$$
                `;

                // Step 4: ì§ˆëŸ‰ì¤‘ì‹¬
                document.getElementById('step4-formula').innerHTML = `
                    $$\\bar{x} = \\frac{M_0}{M} = \\frac{${exact.moment.toFixed(4)}}{${exact.mass.toFixed(4)}} = ${exact.centerOfMass.toFixed(4)}$$
                `;

                // LaTeX ë Œë”ë§
                this.renderMath(document.getElementById('steps-content'));
            },

            updateBalanceSimulation(state, exact) {
                document.getElementById('balance-com').textContent = exact.centerOfMass.toFixed(3);
                BalanceSimulator.setCenterOfMass(exact.centerOfMass);
                BalanceSimulator.updateRodGradient(state);
            },

            renderMath(element) {
                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(element, {
                        delimiters: [
                            { left: '$$', right: '$$', display: true },
                            { left: '$', right: '$', display: false }
                        ]
                    });
                }
            }
        };

        // ============================================================
        // 6. ë¦¬ë§Œ í•© ì• ë‹ˆë©”ì´í„° (Single Responsibility: ì• ë‹ˆë©”ì´ì…˜ë§Œ ë‹´ë‹¹)
        // ============================================================
        const RiemannAnimator = {
            isPlaying: false,
            intervalId: null,
            nValues: [1, 2, 4, 8, 16, 32, 64, 100],
            currentIndex: 0,

            toggle() {
                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.play();
                }
            },

            play() {
                this.isPlaying = true;
                document.getElementById('play-icon').textContent = 'â¸';
                document.getElementById('play-btn').querySelector('span:last-child') || 
                    (document.getElementById('play-btn').innerHTML = '<span id="play-icon">â¸</span> ì¼ì‹œì •ì§€');
                
                this.intervalId = setInterval(() => {
                    this.currentIndex = (this.currentIndex + 1) % this.nValues.length;
                    const n = this.nValues[this.currentIndex];
                    
                    document.getElementById('riemann-n').value = n;
                    document.getElementById('riemann-n-value').textContent = n;
                    
                    AppState.update({ riemannN: n });
                }, 1000);
            },

            pause() {
                this.isPlaying = false;
                document.getElementById('play-icon').textContent = 'â–¶';
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
            },

            reset() {
                this.pause();
                this.currentIndex = 0;
                const n = 10;
                document.getElementById('riemann-n').value = n;
                document.getElementById('riemann-n-value').textContent = n;
                AppState.update({ riemannN: n });
            }
        };

        // ============================================================
        // 7. ê³„ì‚° ê³¼ì • í† ê¸€ëŸ¬ (Single Responsibility: í† ê¸€ë§Œ ë‹´ë‹¹)
        // ============================================================
        const CalculationSteps = {
            isOpen: false,

            toggle() {
                this.isOpen = !this.isOpen;
                const content = document.getElementById('steps-content');
                const arrow = document.getElementById('steps-arrow');
                
                if (this.isOpen) {
                    content.classList.add('active');
                    arrow.textContent = 'â–²';
                    UIUpdater.renderMath(content);
                } else {
                    content.classList.remove('active');
                    arrow.textContent = 'â–¼';
                }
            }
        };

        // ============================================================
        // 8. ë¹„êµ ê´€ë¦¬ì (Single Responsibility: ë¹„êµ ê¸°ëŠ¥ë§Œ ë‹´ë‹¹)
        // ============================================================
        const ComparisonManager = {
            presets: {
                        'uniform': { type: 'uniform', a: 1, b: 0, name: 'ê· ì¼ ë°€ë„' },
                        'left-heavy': { type: 'linear-decrease', a: 2, b: 1.5, name: 'ì™¼ìª½ ë¬´ê±°ì›€' },
                        'right-heavy': { type: 'linear-increase', a: 0.5, b: 2, name: 'ì˜¤ë¥¸ìª½ ë¬´ê±°ì›€' },
                        'center-heavy': { type: 'sine', a: 1, b: 0.8, name: 'ì¤‘ì•™ ë¬´ê±°ì›€' },
                        'edges-heavy': { type: 'quadratic', a: 1.5, b: 2, name: 'ì–‘ë ë¬´ê±°ì›€' }
                    },

            applyPreset(presetName) {
                const preset = this.presets[presetName];
                if (preset) {
                    document.getElementById('density-type').value = preset.type;
                    document.getElementById('param-a').value = preset.a;
                    document.getElementById('param-b').value = preset.b;
                    document.getElementById('param-a-value').textContent = preset.a.toFixed(1);
                    document.getElementById('param-b-value').textContent = preset.b.toFixed(1);
                    
                    AppState.update({
                        densityType: preset.type,
                        paramA: preset.a,
                        paramB: preset.b
                    });

                    // ë²„íŠ¼ í™œì„±í™” í‘œì‹œ
                    document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
                    event.target.classList.add('active');
                }
            },

            updateComparisonTable(state) {
                const tbody = document.getElementById('comparison-tbody');
                const { intervalStart: a, intervalEnd: b } = state;
                const geometricCenter = (a + b) / 2;
                
                const comparisons = [];
                
                Object.entries(this.presets).forEach(([key, preset]) => {
                    const config = DensityFunctions[preset.type];
                    const rho = (x) => config.fn(x, { a: preset.a, b: preset.b });
                    const result = NumericalIntegration.centerOfMass(rho, a, b);
                    
                    comparisons.push({
                        name: preset.name,
                        latex: config.latex(preset.a, preset.b),
                        mass: result.mass,
                        moment: result.moment,
                        centerOfMass: result.centerOfMass,
                        diff: result.centerOfMass - geometricCenter,
                        xVals: GraphRenderer.linspace(a, b, 100),
                        yVals: GraphRenderer.linspace(a, b, 100).map(rho)
                    });
                });

                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                tbody.innerHTML = comparisons.map(comp => `
                    <tr>
                        <td>${comp.name}</td>
                        <td>${comp.mass.toFixed(4)}</td>
                        <td>${comp.moment.toFixed(4)}</td>
                        <td><strong>${comp.centerOfMass.toFixed(4)}</strong></td>
                        <td style="color: ${comp.diff >= 0 ? '#27ae60' : '#e74c3c'}">
                            ${comp.diff >= 0 ? '+' : ''}${comp.diff.toFixed(4)}
                        </td>
                    </tr>
                `).join('');

                // ë¹„êµ ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
                GraphRenderer.renderComparisonGraph('comparison-graph', comparisons);
            }
        };

        // ============================================================
        // 9. ê· í˜• ì‹œë®¬ë ˆì´í„° (Single Responsibility: ê· í˜• ì‹œë®¬ë ˆì´ì…˜ë§Œ ë‹´ë‹¹)
        // ============================================================
        const BalanceSimulator = {
            centerOfMass: 0.5,
            pivotPosition: 0.5,
            isDragging: false,

            init() {
                const pivot = document.getElementById('balance-pivot');
                const container = document.getElementById('balance-container');

                pivot.addEventListener('mousedown', (e) => {
                    this.isDragging = true;
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (!this.isDragging) return;
                    
                    const rect = container.getBoundingClientRect();
                    const x = (e.clientX - rect.left) / rect.width;
                    this.pivotPosition = Math.max(0.1, Math.min(0.9, x));
                    
                    this.updateDisplay();
                });

                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                });

                // í„°ì¹˜ ì§€ì›
                pivot.addEventListener('touchstart', (e) => {
                    this.isDragging = true;
                    e.preventDefault();
                });

                document.addEventListener('touchmove', (e) => {
                    if (!this.isDragging) return;
                    
                    const rect = container.getBoundingClientRect();
                    const touch = e.touches[0];
                    const x = (touch.clientX - rect.left) / rect.width;
                    this.pivotPosition = Math.max(0.1, Math.min(0.9, x));
                    
                    this.updateDisplay();
                });

                document.addEventListener('touchend', () => {
                    this.isDragging = false;
                });
            },

            setCenterOfMass(com) {
                this.centerOfMass = com;
                this.updateDisplay();
            },

            updateRodGradient(state) {
                const rod = document.getElementById('balance-rod');
                const rho = state.getDensityFunction();
                const { intervalStart: a, intervalEnd: b } = state;
                rod.style.background = UIUpdater.createDensityGradient(rho, a, b);
            },

            updateDisplay() {
                const pivot = document.getElementById('balance-pivot');
                const rod = document.getElementById('balance-rod');
                const message = document.getElementById('balance-message');
                
                // ë°›ì¹¨ì  ìœ„ì¹˜ë§Œ ì—…ë°ì´íŠ¸ (ë§‰ëŒ€ëŠ” í•­ìƒ ì¤‘ì•™ì— ê³ ì •)
                pivot.style.left = `${this.pivotPosition * 100}%`;
                document.getElementById('pivot-position').textContent = this.pivotPosition.toFixed(3);

                // ê¸°ìš¸ê¸° ê³„ì‚° (ë°›ì¹¨ì  ê¸°ì¤€ìœ¼ë¡œ íšŒì „)
                const diff = this.centerOfMass - this.pivotPosition;
                const angle = Math.max(-30, Math.min(30, diff * 100));
                
                // ë§‰ëŒ€ëŠ” ì¤‘ì•™ ê³ ì •, ë°›ì¹¨ì  ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ê¸°ìš¸ê¸°ë§Œ ë³€ê²½
                // transform-originì„ ë°›ì¹¨ì  ìœ„ì¹˜ë¡œ ë™ì  ì„¤ì •
                const originX = this.pivotPosition * 100;
                rod.style.transformOrigin = `${originX}% center`;
                rod.style.transform = `translateX(-50%) rotate(${angle}deg)`;

                // ê· í˜• ë©”ì‹œì§€
                const tolerance = 0.02;
                if (Math.abs(diff) < tolerance) {
                    message.textContent = 'âš–ï¸ ê· í˜•!';
                    message.className = 'balance-message balanced';
                } else if (diff > 0) {
                    message.textContent = 'â†’ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§';
                    message.className = 'balance-message unbalanced';
                } else {
                    message.textContent = 'â† ì™¼ìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§';
                    message.className = 'balance-message unbalanced';
                }
            }
        };

        // ============================================================
        // 10. ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ (Dependency Inversion: ëª¨ë“  ëª¨ë“ˆ ì¡°ìœ¨)
        // ============================================================
        const MainController = {
            init() {
                this.setupEventListeners();
                this.subscribeToState();
                BalanceSimulator.init();
                
                // ì´ˆê¸° ë Œë”ë§
                setTimeout(() => {
                    AppState.notify();
                }, 100);
            },

            setupEventListeners() {
                // ë°€ë„ í•¨ìˆ˜ ìœ í˜• ì„ íƒ
                document.getElementById('density-type').addEventListener('change', (e) => {
                    AppState.update({ densityType: e.target.value });
                });

                // íŒŒë¼ë¯¸í„° A ìŠ¬ë¼ì´ë”
                document.getElementById('param-a').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('param-a-value').textContent = value.toFixed(1);
                    AppState.update({ paramA: value });
                });

                // íŒŒë¼ë¯¸í„° B ìŠ¬ë¼ì´ë”
                document.getElementById('param-b').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('param-b-value').textContent = value.toFixed(1);
                    AppState.update({ paramB: value });
                });

                // êµ¬ê°„ ì„¤ì •
                document.getElementById('interval-start').addEventListener('change', (e) => {
                    AppState.update({ intervalStart: parseFloat(e.target.value) });
                });

                document.getElementById('interval-end').addEventListener('change', (e) => {
                    AppState.update({ intervalEnd: parseFloat(e.target.value) });
                });

                // ë¦¬ë§Œ ë¶„í•  ìˆ˜ ìŠ¬ë¼ì´ë”
                document.getElementById('riemann-n').addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    document.getElementById('riemann-n-value').textContent = value;
                    AppState.update({ riemannN: value });
                });
            },

            subscribeToState() {
                AppState.subscribe((state) => {
                    // ëª¨ë“  ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
                    GraphRenderer.renderDensityGraph('density-graph', state);
                    GraphRenderer.renderMomentGraph('moment-graph', state);
                    GraphRenderer.renderRiemannGraph('riemann-graph', state);

                    // UI ì—…ë°ì´íŠ¸
                    UIUpdater.updateFormulaDisplay(state);
                    const exact = UIUpdater.updateResults(state);
                    UIUpdater.updateRodVisualization(state, exact);
                    UIUpdater.updateCalculationSteps(state, exact);
                    UIUpdater.updateBalanceSimulation(state, exact);

                    // ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                    ComparisonManager.updateComparisonTable(state);
                });
            }
        };

        // ============================================================
        // ì´ˆê¸°í™”
        // ============================================================
        document.addEventListener('DOMContentLoaded', () => {
            MainController.init();
        });
    </script>
</body>
</html>