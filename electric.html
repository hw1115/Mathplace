<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‚¤ë¥´íˆí˜¸í”„ ë²•ì¹™ & ê°€ìš°ìŠ¤ ì†Œê±°ë²• - ë³µì¡í•œ íšŒë¡œ ë¶„ì„ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .circuit-diagram {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e0e0;
        }
        
        .circuit-diagram h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            text-align: center;
        }
        
        #circuitCanvas {
            width: 100%;
            height: 500px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        .controls {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e0e0;
            max-height: 570px;
            overflow-y: auto;
        }
        
        .controls h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            position: sticky;
            top: 0;
            background: #f8f9fa;
            padding-bottom: 10px;
            z-index: 10;
        }
        
        .control-group {
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .control-group h3 {
            color: #555;
            margin-bottom: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .control-item label {
            min-width: 60px;
            font-weight: 600;
            color: #444;
            font-size: 14px;
        }
        
        .control-item input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .control-item input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .control-item .unit {
            min-width: 30px;
            color: #666;
            font-weight: 600;
            font-size: 14px;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
            position: sticky;
            bottom: 0;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .calculate-btn:active {
            transform: translateY(0);
        }
        
        .results-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e0e0;
        }
        
        .results-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            text-align: center;
        }
        
        .kirchhoff-equations {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .kirchhoff-equations h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .equation {
            background: #f8f9fa;
            padding: 12px 15px;
            margin: 8px 0;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
            border-radius: 5px;
            line-height: 1.8;
        }
        
        .gaussian-elimination {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .gaussian-elimination h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #764ba2;
            padding-bottom: 8px;
        }
        
        .step {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #764ba2;
        }
        
        .step-title {
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .matrix-container {
            overflow-x: auto;
            margin: 10px 0;
            padding: 5px;
        }
        
        .matrix {
            display: inline-block;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #ddd;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            min-width: 100%;
        }
        
        .matrix-row {
            display: flex;
            gap: 12px;
            margin: 5px 0;
            justify-content: center;
            flex-wrap: nowrap;
        }
        
        .matrix-cell {
            min-width: 90px;
            text-align: right;
            padding: 6px 10px;
            background: #f0f0f0;
            border-radius: 5px;
            color: #333;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .matrix-cell.highlight {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }
        
        .matrix-cell.pivot {
            background: #d4edda;
            border: 2px solid #28a745;
            font-weight: bold;
        }
        
        .final-results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
        }
        
        .final-results h3 {
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }
        
        .result-item {
            background: rgba(255,255,255,0.2);
            padding: 12px 20px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .result-label {
            font-weight: 600;
        }
        
        .result-value {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
        }
        
        .explanation {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
            font-size: 13px;
            color: #0d47a1;
            line-height: 1.6;
        }

        .branch-currents {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .branch-currents h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #ff9800;
            padding-bottom: 8px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .matrix-cell {
                min-width: 70px;
                font-size: 10px;
                padding: 4px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ í‚¤ë¥´íˆí˜¸í”„ ë²•ì¹™ & ê°€ìš°ìŠ¤ ì†Œê±°ë²• íšŒë¡œ ë¶„ì„ê¸°</h1>
        <p class="subtitle">4ê°œì˜ ë©”ì‹œë¥¼ ê°€ì§„ ë³µì¡í•œ íšŒë¡œ ë¶„ì„ - 4Ã—4 í–‰ë ¬ ì‹œìŠ¤í…œ ë‹¨ê³„ë³„ ê°€ìš°ìŠ¤ ì†Œê±°ë²• ì‹œê°í™”</p>
        
        <div class="main-grid">
            <div class="circuit-diagram">
                <h2>ğŸ“Š íšŒë¡œ ë‹¤ì´ì–´ê·¸ë¨ (4-Mesh Network)</h2>
                <canvas id="circuitCanvas"></canvas>
            </div>
            
            <div class="controls">
                <h2>ğŸ”§ íšŒë¡œ íŒŒë¼ë¯¸í„° ì„¤ì •</h2>
                
                <div class="control-group">
                    <h3>ğŸ”‹ ì „ì••ì› (Voltage Sources)</h3>
                    <div class="control-item">
                        <label>Eâ‚:</label>
                        <input type="number" id="e1" value="24" step="0.1">
                        <span class="unit">V</span>
                    </div>
                    <div class="control-item">
                        <label>Eâ‚‚:</label>
                        <input type="number" id="e2" value="18" step="0.1">
                        <span class="unit">V</span>
                    </div>
                    <div class="control-item">
                        <label>Eâ‚ƒ:</label>
                        <input type="number" id="e3" value="12" step="0.1">
                        <span class="unit">V</span>
                    </div>
                    <div class="control-item">
                        <label>Eâ‚„:</label>
                        <input type="number" id="e4" value="9" step="0.1">
                        <span class="unit">V</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>âš¡ ì €í•­ (Resistors)</h3>
                    <div class="control-item">
                        <label>Râ‚:</label>
                        <input type="number" id="r1" value="5" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚‚:</label>
                        <input type="number" id="r2" value="3" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚ƒ:</label>
                        <input type="number" id="r3" value="4" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚„:</label>
                        <input type="number" id="r4" value="6" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚…:</label>
                        <input type="number" id="r5" value="2" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚†:</label>
                        <input type="number" id="r6" value="7" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚‡:</label>
                        <input type="number" id="r7" value="4" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚ˆ:</label>
                        <input type="number" id="r8" value="5" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                    <div class="control-item">
                        <label>Râ‚‰:</label>
                        <input type="number" id="r9" value="3" step="0.1">
                        <span class="unit">Î©</span>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculate()">ğŸ§® ê³„ì‚° ì‹œì‘</button>
            </div>
        </div>
        
        <div class="results-section" id="results" style="display:none;">
            <h2>ğŸ“ˆ ê³„ì‚° ê²°ê³¼ ë° ë‹¨ê³„ë³„ ë¶„ì„</h2>
            
            <div class="kirchhoff-equations">
                <h3>1ï¸âƒ£ í‚¤ë¥´íˆí˜¸í”„ ì „ì•• ë²•ì¹™ (KVL) ì ìš© - ë©”ì‹œ ë°©ì •ì‹</h3>
                <div class="explanation">
                    <strong>ë©”ì‹œ í•´ì„ë²• (Mesh Analysis):</strong> ê° ííšŒë¡œ(ë©”ì‹œ)ì— ëŒ€í•´ í‚¤ë¥´íˆí˜¸í”„ ì „ì•• ë²•ì¹™ì„ ì ìš©í•©ë‹ˆë‹¤.
                    ëª¨ë“  ë©”ì‹œ ì „ë¥˜ëŠ” ì‹œê³„ë°©í–¥ìœ¼ë¡œ ê°€ì •í•˜ë©°, ê³µìœ  ì €í•­ì—ì„œëŠ” ì¸ì ‘ ë©”ì‹œ ì „ë¥˜ì˜ ì˜í–¥ì„ ê³ ë ¤í•©ë‹ˆë‹¤.
                </div>
                <div id="kvlEquations"></div>
            </div>
            
            <div class="gaussian-elimination">
                <h3>2ï¸âƒ£ ê°€ìš°ìŠ¤ ì†Œê±°ë²• (Gaussian Elimination) - ì „ë°© ì†Œê±° ê³¼ì •</h3>
                <div class="explanation">
                    <strong>ëª©í‘œ:</strong> 4Ã—4 í™•ëŒ€ í–‰ë ¬ì„ ìƒì‚¼ê° í–‰ë ¬(Upper Triangular Matrix)ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
                    ê° ë‹¨ê³„ì—ì„œ í”¼ë²— ì›ì†Œ(ëŒ€ê°ì„  ì›ì†Œ) ì•„ë˜ì˜ ëª¨ë“  ì›ì†Œë¥¼ 0ìœ¼ë¡œ ë§Œë“¤ë©°, ë¶€ë¶„ í”¼ë²—íŒ…(Partial Pivoting)ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì¹˜ì  ì•ˆì •ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.
                </div>
                <div id="gaussianSteps"></div>
            </div>
            
            <div class="gaussian-elimination">
                <h3>3ï¸âƒ£ í›„ë°© ëŒ€ì… (Back Substitution)</h3>
                <div class="explanation">
                    <strong>ë°©ë²•:</strong> ìƒì‚¼ê° í–‰ë ¬ì„ ì–»ì€ í›„, ë§ˆì§€ë§‰ ë°©ì •ì‹(4ë²ˆì§¸)ë¶€í„° ì‹œì‘í•˜ì—¬ ìœ„ë¡œ ì˜¬ë¼ê°€ë©° ê° ë¯¸ì§€ìˆ˜ë¥¼ ì°¨ë¡€ë¡œ êµ¬í•©ë‹ˆë‹¤.
                    ê° ë‹¨ê³„ì—ì„œ ì´ë¯¸ êµ¬í•œ ê°’ë“¤ì„ ëŒ€ì…í•˜ì—¬ ê³„ì‚°í•©ë‹ˆë‹¤.
                </div>
                <div id="backSubstitution"></div>
            </div>
            
            <div class="final-results">
                <h3>âœ¨ ìµœì¢… ë©”ì‹œ ì „ë¥˜ ê²°ê³¼</h3>
                <div id="finalCurrents"></div>
            </div>

            <div class="branch-currents">
                <h3>4ï¸âƒ£ ê° ì†Œìë¥¼ í†µê³¼í•˜ëŠ” ì‹¤ì œ ì „ë¥˜</h3>
                <div class="explanation">
                    ê³µìœ  ì €í•­ì„ í†µê³¼í•˜ëŠ” ì „ë¥˜ëŠ” ì¸ì ‘í•œ ë©”ì‹œ ì „ë¥˜ë“¤ì˜ ì°¨ì´ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
                </div>
                <div id="branchCurrents"></div>
            </div>
        </div>
    </div>

    <script>
        // íšŒë¡œ ê·¸ë¦¬ê¸°
        function drawCircuit() {
            const canvas = document.getElementById('circuitCanvas');
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            
            const width = rect.width;
            const height = rect.height;
            
            ctx.clearRect(0, 0, width, height);
            
            // ìŠ¤íƒ€ì¼ ì„¤ì •
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2.5;
            ctx.font = 'bold 12px Arial';
            ctx.fillStyle = '#333';
            
            const margin = 40;
            const meshWidth = (width - 2 * margin) / 2;
            const meshHeight = (height - 2 * margin) / 2;
            
            // ê·¸ë¦¬ë“œ ë…¸ë“œ ì •ì˜ (3x3 ê·¸ë¦¬ë“œ)
            const nodes = [];
            for (let row = 0; row < 3; row++) {
                nodes[row] = [];
                for (let col = 0; col < 3; col++) {
                    nodes[row][col] = {
                        x: margin + col * meshWidth,
                        y: margin + row * meshHeight
                    };
                }
            }
            
            // ë°°í„°ë¦¬ ê·¸ë¦¬ê¸° í•¨ìˆ˜
            function drawBattery(x1, y1, x2, y2, label) {
                const dx = x2 - x1;
                const dy = y2 - y1;
                const len = Math.sqrt(dx * dx + dy * dy);
                const ux = dx / len;
                const uy = dy / len;
                
                const midX = (x1 + x2) / 2;
                const midY = (y1 + y2) / 2;
                
                ctx.save();
                ctx.translate(midX, midY);
                ctx.rotate(Math.atan2(dy, dx));
                
                // ì„  ê·¸ë¦¬ê¸°
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                ctx.moveTo(-len/2, 0);
                ctx.lineTo(-20, 0);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(20, 0);
                ctx.lineTo(len/2, 0);
                ctx.stroke();
                
                // ë°°í„°ë¦¬ ì‹¬ë³¼
                ctx.strokeStyle = '#d32f2f';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(-15, -8);
                ctx.lineTo(-15, 8);
                ctx.stroke();
                
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(-5, -12);
                ctx.lineTo(-5, 12);
                ctx.stroke();
                
                // ë ˆì´ë¸”
                ctx.fillStyle = '#d32f2f';
                ctx.font = 'bold 11px Arial';
                ctx.fillText(label, -8, -18);
                
                ctx.restore();
            }
            
            // ì €í•­ ê·¸ë¦¬ê¸° í•¨ìˆ˜
            function drawResistor(x1, y1, x2, y2, label) {
                const dx = x2 - x1;
                const dy = y2 - y1;
                const len = Math.sqrt(dx * dx + dy * dy);
                
                const midX = (x1 + x2) / 2;
                const midY = (y1 + y2) / 2;
                
                ctx.save();
                ctx.translate(midX, midY);
                ctx.rotate(Math.atan2(dy, dx));
                
                // ì„  ê·¸ë¦¬ê¸°
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                ctx.moveTo(-len/2, 0);
                ctx.lineTo(-25, 0);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(25, 0);
                ctx.lineTo(len/2, 0);
                ctx.stroke();
                
                // ì €í•­ ì‹¬ë³¼
                ctx.strokeStyle = '#1976d2';
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                ctx.moveTo(-25, 0);
                for (let i = 0; i < 5; i++) {
                    ctx.lineTo(-20 + i * 10, i % 2 === 0 ? -6 : 6);
                }
                ctx.lineTo(25, 0);
                ctx.stroke();
                
                // ë ˆì´ë¸”
                ctx.fillStyle = '#1976d2';
                ctx.font = 'bold 11px Arial';
                ctx.fillText(label, -8, 18);
                
                ctx.restore();
            }
            
            // ë©”ì‹œ ì „ë¥˜ í™”ì‚´í‘œ ê·¸ë¦¬ê¸°
            function drawMeshCurrent(x, y, radius, label) {
                ctx.strokeStyle = '#7b1fa2';
                ctx.fillStyle = '#7b1fa2';
                ctx.lineWidth = 2;
                
                // ì›í˜• í™”ì‚´í‘œ
                ctx.beginPath();
                ctx.arc(x, y, radius, 0.3, 2 * Math.PI - 0.3);
                ctx.stroke();
                
                // í™”ì‚´í‘œ ë¨¸ë¦¬
                const angle = -0.3;
                const arrowX = x + radius * Math.cos(angle);
                const arrowY = y + radius * Math.sin(angle);
                ctx.beginPath();
                ctx.moveTo(arrowX, arrowY);
                ctx.lineTo(arrowX - 8, arrowY - 8);
                ctx.lineTo(arrowX - 3, arrowY - 3);
                ctx.closePath();
                ctx.fill();
                
                // ë ˆì´ë¸”
                ctx.font = 'bold 15px Arial';
                ctx.fillText(label, x - 8, y + 5);
            }
            
            // íšŒë¡œ ê·¸ë¦¬ê¸°
            // Mesh 1 (ì¢Œìƒë‹¨)
            drawBattery(nodes[0][0].x, nodes[0][0].y, nodes[0][1].x, nodes[0][1].y, 'Eâ‚');
            drawResistor(nodes[0][1].x, nodes[0][1].y, nodes[1][1].x, nodes[1][1].y, 'Râ‚‚');
            drawResistor(nodes[1][1].x, nodes[1][1].y, nodes[1][0].x, nodes[1][0].y, 'Râ‚„');
            drawResistor(nodes[1][0].x, nodes[1][0].y, nodes[0][0].x, nodes[0][0].y, 'Râ‚');
            
            // Mesh 2 (ìš°ìƒë‹¨)
            drawResistor(nodes[0][1].x, nodes[0][1].y, nodes[0][2].x, nodes[0][2].y, 'Râ‚ƒ');
            drawBattery(nodes[0][2].x, nodes[0][2].y, nodes[1][2].x, nodes[1][2].y, 'Eâ‚‚');
            drawResistor(nodes[1][2].x, nodes[1][2].y, nodes[1][1].x, nodes[1][1].y, 'Râ‚…');
            // Râ‚‚ëŠ” ê³µìœ 
            
            // Mesh 3 (ì¢Œí•˜ë‹¨)
            // Râ‚„ëŠ” ê³µìœ 
            drawResistor(nodes[1][1].x, nodes[1][1].y, nodes[2][1].x, nodes[2][1].y, 'Râ‚‡');
            drawBattery(nodes[2][1].x, nodes[2][1].y, nodes[2][0].x, nodes[2][0].y, 'Eâ‚ƒ');
            drawResistor(nodes[2][0].x, nodes[2][0].y, nodes[1][0].x, nodes[1][0].y, 'Râ‚†');
            
            // Mesh 4 (ìš°í•˜ë‹¨)
            // Râ‚‡ëŠ” ê³µìœ 
            drawResistor(nodes[1][2].x, nodes[1][2].y, nodes[2][2].x, nodes[2][2].y, 'Râ‚ˆ');
            drawBattery(nodes[2][2].x, nodes[2][2].y, nodes[2][1].x, nodes[2][1].y, 'Eâ‚„');
            // Râ‚…ëŠ” ê³µìœ 
            
            // ì¶”ê°€ ì €í•­ Râ‚‰ (ì¤‘ì•™ ìˆ˜í‰)
            const midLeft = { x: nodes[1][0].x, y: nodes[1][0].y };
            const midMid = { x: nodes[1][1].x, y: nodes[1][1].y };
            // Râ‚„ë¡œ ëŒ€ì²´ë¨
            
            // ë…¸ë“œ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#333';
            const nodeRadius = 4;
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 3; col++) {
                    ctx.beginPath();
                    ctx.arc(nodes[row][col].x, nodes[row][col].y, nodeRadius, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
            
            // ë©”ì‹œ ì „ë¥˜ í‘œì‹œ
            const meshCenters = [
                { x: (nodes[0][0].x + nodes[1][1].x) / 2, y: (nodes[0][0].y + nodes[1][1].y) / 2, label: 'Iâ‚' },
                { x: (nodes[0][1].x + nodes[1][2].x) / 2, y: (nodes[0][1].y + nodes[1][2].y) / 2, label: 'Iâ‚‚' },
                { x: (nodes[1][0].x + nodes[2][1].x) / 2, y: (nodes[1][0].y + nodes[2][1].y) / 2, label: 'Iâ‚ƒ' },
                { x: (nodes[1][1].x + nodes[2][2].x) / 2, y: (nodes[1][1].y + nodes[2][2].y) / 2, label: 'Iâ‚„' }
            ];
            
            meshCenters.forEach(mesh => {
                drawMeshCurrent(mesh.x, mesh.y, 35, mesh.label);
            });
        }
        
        // í–‰ë ¬ í‘œì‹œ í•¨ìˆ˜
        function displayMatrix(matrix, highlightRow = -1, highlightCol = -1, pivotRow = -1, pivotCol = -1) {
            let html = '<div class="matrix">';
            for (let i = 0; i < matrix.length; i++) {
                html += '<div class="matrix-row">';
                for (let j = 0; j < matrix[i].length; j++) {
                    let className = 'matrix-cell';
                    if (i === pivotRow && j === pivotCol) {
                        className += ' pivot';
                    } else if (i === highlightRow || j === highlightCol) {
                        className += ' highlight';
                    }
                    html += `<span class="${className}">${matrix[i][j].toFixed(4)}</span>`;
                }
                html += '</div>';
            }
            html += '</div>';
            return html;
        }
        
        // ê°€ìš°ìŠ¤ ì†Œê±°ë²•
        function gaussianElimination(A, b) {
            const n = A.length;
            const augmented = [];
            
            // í™•ëŒ€ í–‰ë ¬ ìƒì„±
            for (let i = 0; i < n; i++) {
                augmented[i] = [...A[i], b[i]];
            }
            
            const steps = [];
            
            // ì´ˆê¸° í–‰ë ¬
            steps.push({
                title: 'ì´ˆê¸° í™•ëŒ€ í–‰ë ¬ [A|b]',
                description: `${n}Ã—${n} ê³„ìˆ˜ í–‰ë ¬ Aì™€ ìƒìˆ˜ ë²¡í„° bë¥¼ ê²°í•©í•œ í™•ëŒ€ í–‰ë ¬ì…ë‹ˆë‹¤. ì´ í–‰ë ¬ì„ ìƒì‚¼ê° í–‰ë ¬ë¡œ ë³€í™˜í•  ê²ƒì…ë‹ˆë‹¤.`,
                matrix: augmented.map(row => [...row])
            });
            
            // ì „ë°© ì†Œê±° (Forward Elimination)
            for (let k = 0; k < n - 1; k++) {
                // í”¼ë²— ì°¾ê¸° (ë¶€ë¶„ í”¼ë²—íŒ…)
                let maxRow = k;
                for (let i = k + 1; i < n; i++) {
                    if (Math.abs(augmented[i][k]) > Math.abs(augmented[maxRow][k])) {
                        maxRow = i;
                    }
                }
                
                // í–‰ êµí™˜
                if (maxRow !== k) {
                    [augmented[k], augmented[maxRow]] = [augmented[maxRow], augmented[k]];
                    steps.push({
                        title: `ğŸ”„ í–‰ êµí™˜: R${k+1} â†” R${maxRow+1}`,
                        description: `ìˆ˜ì¹˜ì  ì•ˆì •ì„±ì„ ìœ„í•´ ${k+1}ë²ˆì§¸ ì—´ì—ì„œ ì ˆëŒ“ê°’ì´ ê°€ì¥ í° ì›ì†Œë¥¼ í”¼ë²—ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤. (ë¶€ë¶„ í”¼ë²—íŒ…, Partial Pivoting)`,
                        matrix: augmented.map(row => [...row]),
                        pivotRow: k,
                        pivotCol: k
                    });
                }
                
                // í”¼ë²—ì´ 0ì¸ ê²½ìš° ì²˜ë¦¬
                if (Math.abs(augmented[k][k]) < 1e-10) {
                    console.error('íŠ¹ì´ í–‰ë ¬: í•´ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ë¬´ìˆ˜íˆ ë§ìŠµë‹ˆë‹¤.');
                    return null;
                }
                
                // kë²ˆì§¸ ì—´ì˜ ì•„ë˜ ì›ì†Œë“¤ì„ 0ìœ¼ë¡œ ë§Œë“¤ê¸°
                for (let i = k + 1; i < n; i++) {
                    const factor = augmented[i][k] / augmented[k][k];
                    
                    if (Math.abs(factor) > 1e-10) {
                        for (let j = k; j <= n; j++) {
                            augmented[i][j] -= factor * augmented[k][j];
                        }
                        
                        steps.push({
                            title: `ğŸ”¢ í–‰ ì—°ì‚°: R${i+1} â† R${i+1} - (${factor.toFixed(4)}) Ã— R${k+1}`,
                            description: `${i+1}ë²ˆì§¸ í–‰ì˜ ${k+1}ë²ˆì§¸ ì—´ ì›ì†Œë¥¼ 0ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤. ìŠ¹ìˆ˜(multiplier) m${i+1}${k+1} = a[${i+1}][${k+1}] / a[${k+1}][${k+1}] = ${augmented[i][k].toFixed(4)} / ${augmented[k][k].toFixed(4)} = ${factor.toFixed(4)}`,
                            matrix: augmented.map(row => [...row]),
                            highlightRow: i,
                            pivotRow: k,
                            pivotCol: k
                        });
                    }
                }
            }
            
            steps.push({
                title: 'âœ… ìƒì‚¼ê° í–‰ë ¬ ì™„ì„± (Upper Triangular Form)',
                description: 'ì „ë°© ì†Œê±°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ê°ì„  ì•„ë˜ì˜ ëª¨ë“  ì›ì†Œê°€ 0ì´ ë˜ì–´ ìƒì‚¼ê° í–‰ë ¬ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ í›„ë°© ëŒ€ì…ì„ ì‹œì‘í•©ë‹ˆë‹¤.',
                matrix: augmented.map(row => [...row])
            });
            
            // í›„ë°© ëŒ€ì… (Back Substitution)
            const x = new Array(n);
            const backSteps = [];
            
            for (let i = n - 1; i >= 0; i--) {
                let sum = 0;
                let calculation = `I${i+1} = (b${i+1} `;
                let calcDetail = `I${i+1} = (${augmented[i][n].toFixed(4)}`;
                
                for (let j = i + 1; j < n; j++) {
                    sum += augmented[i][j] * x[j];
                    if (Math.abs(augmented[i][j]) > 1e-10) {
                        calculation += ` - a${i+1}${j+1}Ã—I${j+1}`;
                        calcDetail += ` - (${augmented[i][j].toFixed(4)}) Ã— (${x[j].toFixed(6)})`;
                    }
                }
                
                x[i] = (augmented[i][n] - sum) / augmented[i][i];
                calculation += `) / a${i+1}${i+1}`;
                calcDetail += `) / ${augmented[i][i].toFixed(4)}`;
                
                backSteps.push({
                    variable: `I${i+1}`,
                    calculation: calculation,
                    calcDetail: calcDetail,
                    value: x[i],
                    step: n - i
                });
            }
            
            return { steps, backSteps, solution: x };
        }
        
        // ê³„ì‚° í•¨ìˆ˜
        function calculate() {
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const E1 = parseFloat(document.getElementById('e1').value);
            const E2 = parseFloat(document.getElementById('e2').value);
            const E3 = parseFloat(document.getElementById('e3').value);
            const E4 = parseFloat(document.getElementById('e4').value);
            const R1 = parseFloat(document.getElementById('r1').value);
            const R2 = parseFloat(document.getElementById('r2').value);
            const R3 = parseFloat(document.getElementById('r3').value);
            const R4 = parseFloat(document.getElementById('r4').value);
            const R5 = parseFloat(document.getElementById('r5').value);
            const R6 = parseFloat(document.getElementById('r6').value);
            const R7 = parseFloat(document.getElementById('r7').value);
            const R8 = parseFloat(document.getElementById('r8').value);
            const R9 = parseFloat(document.getElementById('r9').value);
            
            // í‚¤ë¥´íˆí˜¸í”„ ì „ì•• ë²•ì¹™ (KVL) ë°©ì •ì‹
            // Mesh 1: E1 - I1*R1 - (I1-I2)*R2 - (I1-I3)*R4 = 0
            // ì •ë¦¬: I1*(R1+R2+R4) - I2*R2 - I3*R4 = E1
            
            // Mesh 2: -(I2-I1)*R2 - I2*R3 - (I2-I4)*R5 + E2 = 0
            // ì •ë¦¬: -I1*R2 + I2*(R2+R3+R5) - I4*R5 = E2
            
            // Mesh 3: -(I3-I1)*R4 - I3*R6 - (I3-I4)*R7 + E3 = 0
            // ì •ë¦¬: -I1*R4 + I3*(R4+R6+R7) - I4*R7 = E3
            
            // Mesh 4: -(I4-I2)*R5 - (I4-I3)*R7 - I4*R8 + E4 = 0
            // ì •ë¦¬: -I2*R5 - I3*R7 + I4*(R5+R7+R8) = E4
            
            const A = [
                [R1+R2+R4,  -R2,         -R4,         0],
                [-R2,       R2+R3+R5,    0,          -R5],
                [-R4,       0,           R4+R6+R7,   -R7],
                [0,         -R5,         -R7,        R5+R7+R8]
            ];
            
            const b = [E1, E2, E3, E4];
            
            // KVL ë°©ì •ì‹ í‘œì‹œ
            let kvlHtml = '';
            
            kvlHtml += `<div class="equation">
                <strong>Mesh 1 (ì¢Œìƒë‹¨):</strong><br>
                KVL: Eâ‚ - Iâ‚Ã—Râ‚ - (Iâ‚-Iâ‚‚)Ã—Râ‚‚ - (Iâ‚-Iâ‚ƒ)Ã—Râ‚„ = 0<br>
                ì „ê°œ: ${E1} - Iâ‚Ã—${R1} - Iâ‚Ã—${R2} + Iâ‚‚Ã—${R2} - Iâ‚Ã—${R4} + Iâ‚ƒÃ—${R4} = 0<br>
                ì •ë¦¬: Iâ‚Ã—(${R1}+${R2}+${R4}) - Iâ‚‚Ã—${R2} - Iâ‚ƒÃ—${R4} = ${E1}<br>
                <strong style="color:#d32f2f;">${A[0][0].toFixed(2)}Ã—Iâ‚ ${A[0][1].toFixed(2)}Ã—Iâ‚‚ ${A[0][2].toFixed(2)}Ã—Iâ‚ƒ + ${A[0][3].toFixed(2)}Ã—Iâ‚„ = ${b[0].toFixed(2)}</strong>
            </div>`;
            
            kvlHtml += `<div class="equation">
                <strong>Mesh 2 (ìš°ìƒë‹¨):</strong><br>
                KVL: -(Iâ‚‚-Iâ‚)Ã—Râ‚‚ - Iâ‚‚Ã—Râ‚ƒ - (Iâ‚‚-Iâ‚„)Ã—Râ‚… + Eâ‚‚ = 0<br>
                ì „ê°œ: -Iâ‚‚Ã—${R2} + Iâ‚Ã—${R2} - Iâ‚‚Ã—${R3} - Iâ‚‚Ã—${R5} + Iâ‚„Ã—${R5} + ${E2} = 0<br>
                ì •ë¦¬: -Iâ‚Ã—${R2} + Iâ‚‚Ã—(${R2}+${R3}+${R5}) + 0Ã—Iâ‚ƒ - Iâ‚„Ã—${R5} = ${E2}<br>
                <strong style="color:#d32f2f;">${A[1][0].toFixed(2)}Ã—Iâ‚ + ${A[1][1].toFixed(2)}Ã—Iâ‚‚ + ${A[1][2].toFixed(2)}Ã—Iâ‚ƒ ${A[1][3].toFixed(2)}Ã—Iâ‚„ = ${b[1].toFixed(2)}</strong>
            </div>`;
            
            kvlHtml += `<div class="equation">
                <strong>Mesh 3 (ì¢Œí•˜ë‹¨):</strong><br>
                KVL: -(Iâ‚ƒ-Iâ‚)Ã—Râ‚„ - Iâ‚ƒÃ—Râ‚† - (Iâ‚ƒ-Iâ‚„)Ã—Râ‚‡ + Eâ‚ƒ = 0<br>
                ì „ê°œ: -Iâ‚ƒÃ—${R4} + Iâ‚Ã—${R4} - Iâ‚ƒÃ—${R6} - Iâ‚ƒÃ—${R7} + Iâ‚„Ã—${R7} + ${E3} = 0<br>
                ì •ë¦¬: -Iâ‚Ã—${R4} + 0Ã—Iâ‚‚ + Iâ‚ƒÃ—(${R4}+${R6}+${R7}) - Iâ‚„Ã—${R7} = ${E3}<br>
                <strong style="color:#d32f2f;">${A[2][0].toFixed(2)}Ã—Iâ‚ + ${A[2][1].toFixed(2)}Ã—Iâ‚‚ + ${A[2][2].toFixed(2)}Ã—Iâ‚ƒ ${A[2][3].toFixed(2)}Ã—Iâ‚„ = ${b[2].toFixed(2)}</strong>
            </div>`;
            
            kvlHtml += `<div class="equation">
                <strong>Mesh 4 (ìš°í•˜ë‹¨):</strong><br>
                KVL: -(Iâ‚„-Iâ‚‚)Ã—Râ‚… - (Iâ‚„-Iâ‚ƒ)Ã—Râ‚‡ - Iâ‚„Ã—Râ‚ˆ + Eâ‚„ = 0<br>
                ì „ê°œ: -Iâ‚„Ã—${R5} + Iâ‚‚Ã—${R5} - Iâ‚„Ã—${R7} + Iâ‚ƒÃ—${R7} - Iâ‚„Ã—${R8} + ${E4} = 0<br>
                ì •ë¦¬: 0Ã—Iâ‚ - Iâ‚‚Ã—${R5} - Iâ‚ƒÃ—${R7} + Iâ‚„Ã—(${R5}+${R7}+${R8}) = ${E4}<br>
                <strong style="color:#d32f2f;">${A[3][0].toFixed(2)}Ã—Iâ‚ ${A[3][1].toFixed(2)}Ã—Iâ‚‚ ${A[3][2].toFixed(2)}Ã—Iâ‚ƒ + ${A[3][3].toFixed(2)}Ã—Iâ‚„ = ${b[3].toFixed(2)}</strong>
            </div>`;
            
            document.getElementById('kvlEquations').innerHTML = kvlHtml;
            
            // ê°€ìš°ìŠ¤ ì†Œê±°ë²• ì‹¤í–‰
            const result = gaussianElimination(A, b);
            
            if (!result) {
                alert('ì˜¤ë¥˜: í–‰ë ¬ì´ íŠ¹ì´ í–‰ë ¬ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê°€ìš°ìŠ¤ ì†Œê±°ë²• ë‹¨ê³„ í‘œì‹œ
            let gaussHtml = '';
            result.steps.forEach((step, index) => {
                gaussHtml += `<div class="step">
                    <div class="step-title">Step ${index}: ${step.title}</div>
                    <div class="explanation">${step.description}</div>
                    <div class="matrix-container">
                        ${displayMatrix(step.matrix, step.highlightRow, step.highlightCol, step.pivotRow, step.pivotCol)}
                    </div>
                </div>`;
            });
            document.getElementById('gaussianSteps').innerHTML = gaussHtml;
            
            // í›„ë°© ëŒ€ì… ë‹¨ê³„ í‘œì‹œ
            let backHtml = '';
            result.backSteps.forEach((step, index) => {
                backHtml += `<div class="step">
                    <div class="step-title">Step ${step.step}: ${step.variable} ê³„ì‚°</div>
                    <div class="equation">
                        ${step.calculation}<br><br>
                        ${step.calcDetail}<br><br>
                        <strong style="color:#764ba2; font-size:15px;">${step.variable} = ${step.value.toFixed(6)} A</strong>
                    </div>
                </div>`;
            });
            document.getElementById('backSubstitution').innerHTML = backHtml;
            
            // ìµœì¢… ê²°ê³¼ í‘œì‹œ
            let finalHtml = '';
            result.solution.forEach((current, index) => {
                const direction = current >= 0 ? 'ì‹œê³„ë°©í–¥ â†»' : 'ë°˜ì‹œê³„ë°©í–¥ â†º';
                const absValue = Math.abs(current).toFixed(6);
                finalHtml += `<div class="result-item">
                    <span class="result-label">ë©”ì‹œ ì „ë¥˜ I${index + 1}:</span>
                    <span class="result-value">${current.toFixed(6)} A (${direction})</span>
                </div>`;
            });
            
            document.getElementById('finalCurrents').innerHTML = finalHtml;
            
            // ê° ì†Œìì˜ ì‹¤ì œ ì „ë¥˜ ê³„ì‚°
            const I1 = result.solution[0];
            const I2 = result.solution[1];
            const I3 = result.solution[2];
            const I4 = result.solution[3];
            
            let branchHtml = '';
            
            branchHtml += `<div class="equation">
                <strong>ë…ë¦½ ì €í•­ (ë‹¨ì¼ ë©”ì‹œ):</strong><br>
                â€¢ Râ‚ ì „ë¥˜: Iâ‚ = ${I1.toFixed(6)} A<br>
                â€¢ Râ‚ƒ ì „ë¥˜: Iâ‚‚ = ${I2.toFixed(6)} A<br>
                â€¢ Râ‚† ì „ë¥˜: Iâ‚ƒ = ${I3.toFixed(6)} A<br>
                â€¢ Râ‚ˆ ì „ë¥˜: Iâ‚„ = ${I4.toFixed(6)} A
            </div>`;
            
            branchHtml += `<div class="equation">
                <strong>ê³µìœ  ì €í•­ (ì¸ì ‘ ë©”ì‹œ ì‚¬ì´):</strong><br>
                â€¢ Râ‚‚ ì „ë¥˜ (Mesh 1-2): Iâ‚ - Iâ‚‚ = ${I1.toFixed(6)} - (${I2.toFixed(6)}) = <strong>${(I1-I2).toFixed(6)} A</strong><br>
                â€¢ Râ‚„ ì „ë¥˜ (Mesh 1-3): Iâ‚ - Iâ‚ƒ = ${I1.toFixed(6)} - (${I3.toFixed(6)}) = <strong>${(I1-I3).toFixed(6)} A</strong><br>
                â€¢ Râ‚… ì „ë¥˜ (Mesh 2-4): Iâ‚‚ - Iâ‚„ = ${I2.toFixed(6)} - (${I4.toFixed(6)}) = <strong>${(I2-I4).toFixed(6)} A</strong><br>
                â€¢ Râ‚‡ ì „ë¥˜ (Mesh 3-4): Iâ‚ƒ - Iâ‚„ = ${I3.toFixed(6)} - (${I4.toFixed(6)}) = <strong>${(I3-I4).toFixed(6)} A</strong>
            </div>`;
            
            // ì „ë ¥ ê³„ì‚°
            branchHtml += `<div class="equation" style="background:#fff3cd; border-left-color:#ffc107;">
                <strong>âš¡ ê° ì €í•­ì—ì„œ ì†Œë¹„ë˜ëŠ” ì „ë ¥ (P = IÂ²R):</strong><br>
                â€¢ Pâ‚ = Iâ‚Â²Ã—Râ‚ = (${I1.toFixed(4)})Â² Ã— ${R1} = <strong>${(I1*I1*R1).toFixed(4)} W</strong><br>
                â€¢ Pâ‚‚ = (Iâ‚-Iâ‚‚)Â²Ã—Râ‚‚ = (${(I1-I2).toFixed(4)})Â² Ã— ${R2} = <strong>${((I1-I2)*(I1-I2)*R2).toFixed(4)} W</strong><br>
                â€¢ Pâ‚ƒ = Iâ‚‚Â²Ã—Râ‚ƒ = (${I2.toFixed(4)})Â² Ã— ${R3} = <strong>${(I2*I2*R3).toFixed(4)} W</strong><br>
                â€¢ Pâ‚„ = (Iâ‚-Iâ‚ƒ)Â²Ã—Râ‚„ = (${(I1-I3).toFixed(4)})Â² Ã— ${R4} = <strong>${((I1-I3)*(I1-I3)*R4).toFixed(4)} W</strong><br>
                â€¢ Pâ‚… = (Iâ‚‚-Iâ‚„)Â²Ã—Râ‚… = (${(I2-I4).toFixed(4)})Â² Ã— ${R5} = <strong>${((I2-I4)*(I2-I4)*R5).toFixed(4)} W</strong><br>
                â€¢ Pâ‚† = Iâ‚ƒÂ²Ã—Râ‚† = (${I3.toFixed(4)})Â² Ã— ${R6} = <strong>${(I3*I3*R6).toFixed(4)} W</strong><br>
                â€¢ Pâ‚‡ = (Iâ‚ƒ-Iâ‚„)Â²Ã—Râ‚‡ = (${(I3-I4).toFixed(4)})Â² Ã— ${R7} = <strong>${((I3-I4)*(I3-I4)*R7).toFixed(4)} W</strong><br>
                â€¢ Pâ‚ˆ = Iâ‚„Â²Ã—Râ‚ˆ = (${I4.toFixed(4)})Â² Ã— ${R8} = <strong>${(I4*I4*R8).toFixed(4)} W</strong><br><br>
                <strong style="color:#d32f2f; font-size:15px;">ì´ ì†Œë¹„ ì „ë ¥ = ${(
                    I1*I1*R1 + 
                    (I1-I2)*(I1-I2)*R2 + 
                    I2*I2*R3 + 
                    (I1-I3)*(I1-I3)*R4 + 
                    (I2-I4)*(I2-I4)*R5 + 
                    I3*I3*R6 + 
                    (I3-I4)*(I3-I4)*R7 + 
                    I4*I4*R8
                ).toFixed(4)} W</strong>
            </div>`;
            
            document.getElementById('branchCurrents').innerHTML = branchHtml;
            
            // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
            document.getElementById('results').style.display = 'block';
            
            // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ íšŒë¡œ ê·¸ë¦¬ê¸°
        window.addEventListener('load', drawCircuit);
        window.addEventListener('resize', drawCircuit);
        
        // ì…ë ¥ê°’ ë³€ê²½ ì‹œ íšŒë¡œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        const inputs = ['e1', 'e2', 'e3', 'e4', 'r1', 'r2', 'r3', 'r4', 'r5', 'r6', 'r7', 'r8', 'r9'];
        inputs.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', drawCircuit);
            }
        });
    </script>
</body>
</html>